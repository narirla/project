<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>관광 정보</title>

  <!-- CSS -->
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/common.css}">
  <link rel="stylesheet" th:href="@{/css/information/restaurants.css}">

  <!-- 외부 폰트 및 아이콘 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.8/dist/web/static/pretendard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- JavaScript 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="text/javascript" th:src="@{'//dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${kakaoMapApiKey}}"></script>
</head>

<body>
<div class="layout-wrapper">
  <!-- 공통 헤더 -->
  <header th:replace="~{fragments/header :: header}"></header>
  <div class="page-container">
    <main class="mypage-container">
      <!-- 사이드바 -->
      <aside class="sidebar">
        <div class="sidebar-card">
          <nav class="mypage-nav">
            <div class="nav-title active">관광 정보</div>
            <ul>
              <li><a href="/information" class="active">부산 맛집</a></li>
              <li><a th:href="@{/information/accessibility}">교통약자 편의시설</a></li>
            </ul>
          </nav>
        </div>
      </aside>
      <!-- 메인 컨텐츠 -->
      <section class="content">
        <!-- 페이지 헤더 -->
        <div class="content-header">
          <h1>관광 정보</h1>
          <p>부산의 관광정보를 찾아보세요</p>
        </div>
        <!-- 대시보드 섹션 (차트 + 지도) -->
        <section class="dashboard-section">
          <div class="dashboard-container">
            <h2 class="section-title">부산 맛집</h2>
            <div class="dashboard-content">
              <!-- 차트 영역 -->
              <div class="charts-container">
                <div class="chart-container">
                  <h3>지역별 맛집</h3>
                  <canvas id="districtChart" width="300" height="200"></canvas>
                </div>
                <div class="chart-container">
                  <h3>업종별 맛집</h3>
                  <canvas id="categoryChart" width="300" height="200"></canvas>
                </div>
              </div>
              <!-- 지도 영역 -->
              <div class="map-container">
                <div id="map"></div>
              </div>
            </div>
          </div>
        </section>
        <!-- 맛집 목록 섹션 -->
        <section class="restaurant-list-section">
          <h2 class="section-title">맛집 목록</h2>
          <!-- 결과 개수 표시 -->
          <div class="service-count">
            <p th:text="|총 ${totalCount}건|"></p>
          </div>
          <!-- 필터 영역 -->
          <div class="filter-container">
            <select id="districtFilter" class="filter-select">
              <option value="">전체 지역</option>
              <option th:each="district : ${districts}"
                      th:value="${district}"
                      th:text="${district}"
                      th:selected="${district == selectedDistrict}">지역명</option>
            </select>

            <select id="categoryFilter" class="filter-select">
              <option value="">전체 업종</option>
              <option th:each="category : ${categories}"
                      th:value="${category}"
                      th:text="${category}"
                      th:selected="${category == selectedCategory}">카테고리</option>
            </select>
            <!-- 검색창 -->
            <div class="search-box">
              <input type="text"
                     id="searchInput"
                     placeholder="검색어를 입력하세요."
                     th:value="${selectedSearch}">
              <button type="button" id="filterBtn" class="search-btn">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
          <!-- 맛집 카드 그리드 -->
          <div class="restaurant-grid" id="restaurantGrid">
            <!-- 데이터 없음 메시지 -->
            <div th:if="${restaurants == null or restaurants.size() == 0}" class="no-data-message">
              <p>
                <i class="fas fa-search"></i>
                “’검색어’에 해당하는 결과가 없습니다.”
                <small>검색어를 수정하거나 필터를 변경해보세요.</small>
              </p>
            </div>
            <!-- 맛집 카드 -->
            <div th:each="restaurant : ${restaurants}" class="restaurant-card">
              <div class="restaurant-image">
                <img th:src="${restaurant.mainImgThumb ?: '/img/default-restaurant.png'}"
                     th:alt="${restaurant.mainTitle}">
                     onerror="this.onerror=null; this.src='/img/default-restaurant.png'">
                <div class="restaurant-badge" th:if="${restaurant.gugunNm}" th:text="${restaurant.gugunNm}">지역</div>
              </div>
              <div class="restaurant-info">
                <h3 class="restaurant-name" th:text="${restaurant.mainTitle}">맛집명</h3>
                <p class="restaurant-address" th:text="${restaurant.addr1}">주소</p>
                <p class="restaurant-menu" th:if="${restaurant.rprsnTvMenu}" th:text="${restaurant.rprsnTvMenu}">대표메뉴</p>

                <div class="restaurant-actions">
                  <a th:href="@{'/information/restaurants/' + ${restaurant.ucSeq}}" class="btn-detail">상세보기</a>
                </div>
              </div>
            </div>
          </div>
          <!-- 페이징 -->
          <div class="pagination" th:if="${totalCount > 0}">
            <!-- 처음으로 -->
            <a th:if="${currentPage > 1}"
               th:href="@{/information(page=1, size=15, search=${selectedSearch}, district=${selectedDistrict}, category=${selectedCategory})}"
               class="page-link">&lt;&lt;</a>
            <span th:unless="${currentPage > 1}" class="page-link-spacer">&lt;&lt;</span>
            <!-- 이전 페이지 -->
            <a th:if="${currentPage > 1}"
               th:with="prevPageTarget = (${currentPage == startPage and startPage > 1} ? ${startPage - 1} : ${currentPage - 1})"
               th:href="@{/information(page=${prevPageTarget}, size=15, search=${selectedSearch}, district=${selectedDistrict}, category=${selectedCategory})}"
               class="page-link">&lt;</a>
            <span th:unless="${currentPage > 1}" class="page-link-spacer">&lt;</span>
            <!-- 페이지 번호들 -->
            <th:block th:each="i : ${#numbers.sequence(startPage, endPage)}">
              <a th:if="${i == currentPage}"
                 th:href="@{/information(page=${i}, size=15, search=${selectedSearch}, district=${selectedDistrict}, category=${selectedCategory})}"
                 class="page-link active" th:text="${i}">1</a>
              <a th:if="${i != currentPage}"
                 th:href="@{/information(page=${i}, size=15, search=${selectedSearch}, district=${selectedDistrict}, category=${selectedCategory})}"
                 class="page-link" th:text="${i}">1</a>
            </th:block>
            <!-- 다음 페이지 -->
            <a th:if="${currentPage < totalPages}"
               th:with="nextPageTarget = (${currentPage == endPage and endPage < totalPages} ? ${endPage + 1} : ${currentPage + 1})"
               th:href="@{/information(page=${nextPageTarget}, size=15, search=${selectedSearch}, district=${selectedDistrict}, category=${selectedCategory})}"
               class="page-link">&gt;</a>
            <span th:unless="${currentPage < totalPages}" class="page-link-spacer">&gt;</span>
            <!-- 마지막으로 -->
            <a th:if="${currentPage < totalPages}"
               th:href="@{/information(page=${totalPages}, size=15, search=${selectedSearch}, district=${selectedDistrict}, category=${selectedCategory})}"
               class="page-link">&gt;&gt;</a>
            <span th:unless="${currentPage < totalPages}" class="page-link-spacer">&gt;&gt;</span>
          </div>
        </section>
      </section>
    </main>
  </div>
  <!-- 공통 푸터 -->
  <footer th:replace="~{fragments/footer :: footer}"></footer>
</div>
<!-- 서버 데이터 JavaScript로 전달 -->
<script th:inline="javascript">
  console.log('서버 데이터 확인');
  console.log('restaurants:', /*[[${restaurants}]]*/ []);
  console.log('allRestaurants:', /*[[${allRestaurants}]]*/ []);
  console.log('totalCount:', /*[[${totalCount}]]*/ 0);

  const allRestaurants = /*[[${allRestaurants}]]*/ [];
  const filteredRestaurants = /*[[${filteredRestaurants}]]*/ [];
  const kakaoMapApiKey = /*[[${kakaoMapApiKey}]]*/ '';

  console.log('JavaScript 변수');
  console.log('allRestaurants:', allRestaurants);
  console.log('filteredRestaurants:', filteredRestaurants);
</script>
<script th:src="@{/js/information/restaurants.js}"></script>
</body>
</html>