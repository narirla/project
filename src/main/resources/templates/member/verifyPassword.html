<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="UTF-8">
  <title>비밀번호 재확인</title>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/common.css}">
  <link rel="stylesheet" th:href="@{/css/member/verifyPassword.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.8/dist/web/static/pretendard.css">
</head>

<body>
  <div class="layout-wrapper">
    <!-- 헤더: 기본값 BUYER 가드 -->
    <th:block th:switch="${session.loginRole ?: 'BUYER'}">
      <header th:case="'SELLER'" th:replace="~{fragments/sellerHeader :: sellerHeader(activeUri=${currentPath ?: ''})}">
      </header>
      <header th:case="*" th:replace="~{fragments/header :: header(activeUri=${currentPath ?: ''})}"></header>
    </th:block>

    <div class="page-layout">
      <!-- 사이드바: requestURI 안전 처리 -->
      <th:block th:switch="${session.loginRole ?: 'BUYER'}">
        <aside th:case="'SELLER'"
               th:replace="~{fragments/sellerSidebar ::
         sellerSidebar(activePath=${'/members/verify-password'}, sp=${sellerPage} ?: null)}">
        </aside>
        <aside th:case="*"
               th:replace="~{fragments/buyerSidebar ::
         buyerSidebar(activePath=${'/members/verify-password'}, member=${member ?: session.loginMember})}">
        </aside>
      </th:block>

      <!-- 본문 -->
      <main class="page-content" role="main">
        <h2>비밀번호 재확인</h2>
        <hr class="line">

        <!-- 플래시 에러 -->
        <div th:if="${error}" class="error-box" th:text="${error}"></div>

        <form th:action="@{/members/verify-password}" method="post" th:object="${passwordForm}" class="verify-form">
          <input type="hidden" name="next" th:value="${next}">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

          <div class="form-row">
            <label for="currentPassword" class="form-label">비밀번호</label>
            <div class="input-wrap">
              <i class="fa-solid fa-lock input-icon" aria-hidden="true"></i>
              <input id="currentPassword"
                     type="password"
                     th:field="*{currentPassword}"
                     class="form-input"
                     placeholder="비밀번호를 입력하세요"
                     autocomplete="current-password"
                     required>
              <!-- X 버튼(지우기) : 값이 있을 때만 표시 -->
              <button class="clear-btn" type="button" aria-label="입력 지우기" hidden>
                <i class="fa-solid fa-xmark"></i>
              </button>
              <!-- 눈 토글: 기본 숨김 → eye-slash -->
              <button class="toggle-btn" type="button" aria-pressed="false" aria-label="비밀번호 표시">
                <i class="fa-regular fa-eye-slash"></i>
              </button>
            </div>
            <button type="submit" class="btn primary">확인</button>
          </div>
        </form>
      </main>
    </div>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
  </div>

  <!--script-->
  <script defer th:src="@{/js/member/verifyPassword.js}"></script>
  <script th:src="@{/js/layout.js}"></script>
</body>

</html>