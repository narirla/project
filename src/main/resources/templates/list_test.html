<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì—¬í–‰ìƒí’ˆ ëª©ë¡ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .search-section {
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 5px;
    }
    .filter-section {
      margin-bottom: 20px;
      padding: 15px;
      background: #e9ecef;
      border-radius: 5px;
    }
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .product-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: white;
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .product-image {
      width: 100%;
      height: 200px;
      background: #ddd;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }
    .product-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .product-price {
      color: #e74c3c;
      font-weight: bold;
      font-size: 1.2em;
    }
    .product-location {
      color: #666;
      font-size: 0.9em;
    }
    .product-rating {
      color: #f39c12;
      margin: 5px 0;
    }
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 10px;
    }
    .pagination button {
      padding: 8px 12px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer;
      border-radius: 3px;
    }
    .pagination button.active {
      background: #007bff;
      color: white;
    }
    .sort-section {
      margin-bottom: 15px;
    }
    .sort-section select {
      padding: 5px;
      margin-right: 10px;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    .error {
      color: red;
      text-align: center;
      padding: 20px;
    }
    input, select, button {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ddd;
      border-radius: 3px;
    }
    button {
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .server-data {
      background: #e8f4fd;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ì—¬í–‰ìƒí’ˆ ëª©ë¡ í…ŒìŠ¤íŠ¸ (Thymeleaf)</h1>
    
    <!-- ì„œë²„ ë°ì´í„° í‘œì‹œ -->
    <div class="server-data">
      <h3>ì„œë²„ ë°ì´í„° ì •ë³´</h3>
      <p th:if="${products != null}">ì„œë²„ì—ì„œ ë°›ì€ ìƒí’ˆ ìˆ˜: <span th:text="${products.size()}">0</span>ê°œ</p>
      <p th:if="${products == null}">ì„œë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)</p>
      <p th:if="${currentPage != null}">í˜„ì¬ í˜ì´ì§€: <span th:text="${currentPage}">1</span></p>
      <p th:if="${totalPages != null}">ì „ì²´ í˜ì´ì§€: <span th:text="${totalPages}">1</span></p>
      <p th:if="${searchKeyword != null and searchKeyword != ''}">ê²€ìƒ‰ì–´: <span th:text="${searchKeyword}">ì—†ìŒ</span></p>
    </div>
    
    <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
    <div class="search-section">
      <h3>ê²€ìƒ‰</h3>
      <form th:action="@{/product/list}" method="get" id="searchForm">
        <input type="text" id="searchInput" name="keyword" 
               th:value="${searchKeyword}" 
               placeholder="ìƒí’ˆëª…, ì§€ì—­, í‚¤ì›Œë“œ ê²€ìƒ‰...">
        <button type="submit">ê²€ìƒ‰</button>
        <button type="button" onclick="clearSearch()">ì´ˆê¸°í™”</button>
      </form>
    </div>

    <!-- í•„í„° ì„¹ì…˜ -->
    <div class="filter-section">
      <h3>í•„í„°</h3>
      <form th:action="@{/product/list}" method="get" id="filterForm">
        <input type="hidden" name="keyword" th:value="${searchKeyword}">
        <div>
          <label>ì§€ì—­:</label>
          <select id="locationFilter" name="location">
            <option value="">ì „ì²´</option>
            <option value="ì œì£¼" th:selected="${locationFilter == 'ì œì£¼'}">ì œì£¼</option>
            <option value="ë¶€ì‚°" th:selected="${locationFilter == 'ë¶€ì‚°'}">ë¶€ì‚°</option>
            <option value="ì„œìš¸" th:selected="${locationFilter == 'ì„œìš¸'}">ì„œìš¸</option>
            <option value="ê°•ë¦‰" th:selected="${locationFilter == 'ê°•ë¦‰'}">ê°•ë¦‰</option>
            <option value="ê²½ì£¼" th:selected="${locationFilter == 'ê²½ì£¼'}">ê²½ì£¼</option>
          </select>
          
          <label>ê°€ê²©ëŒ€:</label>
          <select id="priceFilter" name="priceRange">
            <option value="">ì „ì²´</option>
            <option value="0-50000" th:selected="${priceFilter == '0-50000'}">5ë§Œì› ì´í•˜</option>
            <option value="50000-100000" th:selected="${priceFilter == '50000-100000'}">5ë§Œì›-10ë§Œì›</option>
            <option value="100000-200000" th:selected="${priceFilter == '100000-200000'}">10ë§Œì›-20ë§Œì›</option>
            <option value="200000-" th:selected="${priceFilter == '200000-'}">20ë§Œì› ì´ìƒ</option>
          </select>
          
          <label>ê¸°ê°„:</label>
          <select id="durationFilter" name="duration">
            <option value="">ì „ì²´</option>
            <option value="1-2" th:selected="${durationFilter == '1-2'}">1-2ì¼</option>
            <option value="3-5" th:selected="${durationFilter == '3-5'}">3-5ì¼</option>
            <option value="6-10" th:selected="${durationFilter == '6-10'}">6-10ì¼</option>
            <option value="10-" th:selected="${durationFilter == '10-'}">10ì¼ ì´ìƒ</option>
          </select>
          
          <button type="submit">í•„í„° ì ìš©</button>
          <button type="button" onclick="clearFilters()">í•„í„° ì´ˆê¸°í™”</button>
        </div>
      </form>
    </div>

    <!-- ì •ë ¬ ì„¹ì…˜ -->
    <div class="sort-section">
      <form th:action="@{/product/list}" method="get" id="sortForm">
        <input type="hidden" name="keyword" th:value="${searchKeyword}">
        <input type="hidden" name="location" th:value="${locationFilter}">
        <input type="hidden" name="priceRange" th:value="${priceFilter}">
        <input type="hidden" name="duration" th:value="${durationFilter}">
        
        <label>ì •ë ¬:</label>
        <select id="sortSelect" name="sort" onchange="this.form.submit()">
          <option value="recommend" th:selected="${sortType == 'recommend'}">ì¶”ì²œìˆœ</option>
          <option value="price-low" th:selected="${sortType == 'price-low'}">ê°€ê²© ë‚®ì€ìˆœ</option>
          <option value="price-high" th:selected="${sortType == 'price-high'}">ê°€ê²© ë†’ì€ìˆœ</option>
          <option value="rating" th:selected="${sortType == 'rating'}">í‰ì ìˆœ</option>
          <option value="newest" th:selected="${sortType == 'newest'}">ìµœì‹ ìˆœ</option>
        </select>
        
        <label>í‘œì‹œ ê°œìˆ˜:</label>
        <select id="pageSizeSelect" name="pageSize" onchange="this.form.submit()">
          <option value="12" th:selected="${pageSize == 12}">12ê°œì”©</option>
          <option value="24" th:selected="${pageSize == 24}">24ê°œì”©</option>
          <option value="48" th:selected="${pageSize == 48}">48ê°œì”©</option>
        </select>
      </form>
    </div>

    <!-- ìƒí’ˆ ëª©ë¡ -->
    <div id="productList" class="product-grid">
      <!-- ì„œë²„ì—ì„œ ë°›ì€ ìƒí’ˆ ë°ì´í„°ê°€ ìˆìœ¼ë©´ í‘œì‹œ -->
      <div th:if="${products != null and !products.empty}" th:each="product : ${products}" class="product-card">
        <div class="product-image">
          <img th:src="${product.imageUrl != null ? product.imageUrl : 'https://via.placeholder.com/300x200'}" 
               th:alt="${product.title}" 
               style="width: 100%; height: 100%; object-fit: cover; border-radius: 5px;">
        </div>
        <div class="product-title" th:text="${product.title}">ìƒí’ˆëª…</div>
        <div class="product-location">ğŸ“ <span th:text="${product.location}">ì§€ì—­</span></div>
        <div class="product-rating">â­ <span th:text="${product.rating}">4.0</span> (<span th:text="${product.duration}">3</span>ë°•<span th:text="${product.duration + 1}">4</span>ì¼)</div>
        <div class="product-price"><span th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')}">100,000</span>ì›</div>
        <div style="font-size: 0.8em; color: #666; margin-top: 5px;" th:text="${product.description}">ìƒí’ˆ ì„¤ëª…</div>
      </div>
      
      <!-- ì„œë²„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ìš© ìƒí’ˆ í‘œì‹œ -->
      <div th:if="${products == null or products.empty}" id="testProductList">
        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
      </div>
    </div>

    <!-- ë¡œë”© í‘œì‹œ -->
    <div id="loading" class="loading" style="display: none;">
      ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>

    <!-- ì—ëŸ¬ í‘œì‹œ -->
    <div id="error" class="error" style="display: none;">
      ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div id="pagination" class="pagination">
      <!-- Thymeleaf í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div th:if="${totalPages != null and totalPages > 1}">
        <!-- ì´ì „ í˜ì´ì§€ -->
        <a th:if="${currentPage > 1}" 
           th:href="@{/product/list(keyword=${searchKeyword}, location=${locationFilter}, priceRange=${priceFilter}, duration=${durationFilter}, sort=${sortType}, pageSize=${pageSize}, page=${currentPage - 1})}"
           style="text-decoration: none;">
          <button>ì´ì „</button>
        </a>
        
        <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
        <span th:each="pageNum : ${#numbers.sequence(1, totalPages)}">
          <a th:if="${pageNum != currentPage}" 
             th:href="@{/product/list(keyword=${searchKeyword}, location=${locationFilter}, priceRange=${priceFilter}, duration=${durationFilter}, sort=${sortType}, pageSize=${pageSize}, page=${pageNum})}"
             style="text-decoration: none;">
            <button th:text="${pageNum}">1</button>
          </a>
          <button th:if="${pageNum == currentPage}" class="active" th:text="${pageNum}">1</button>
        </span>
        
        <!-- ë‹¤ìŒ í˜ì´ì§€ -->
        <a th:if="${currentPage < totalPages}" 
           th:href="@{/product/list(keyword=${searchKeyword}, location=${locationFilter}, priceRange=${priceFilter}, duration=${durationFilter}, sort=${sortType}, pageSize=${pageSize}, page=${currentPage + 1})}"
           style="text-decoration: none;">
          <button>ë‹¤ìŒ</button>
        </a>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ -->
    <div id="testResults" style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
      <h3>í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>
      <div id="testLog"></div>
    </div>
  </div>

  <!-- Thymeleaf ë³€ìˆ˜ë¥¼ JavaScriptë¡œ ì „ë‹¬ -->
  <script th:inline="javascript">
    // Thymeleaf ë³€ìˆ˜ë¥¼ JavaScript ë³€ìˆ˜ë¡œ ì„¤ì •
    const serverData = {
      hasServerProducts: [[${products != null and !products.empty}]],
      currentPage: [[${currentPage != null ? currentPage : 1}]],
      totalPages: [[${totalPages != null ? totalPages : 1}]],
      searchKeyword: [[${searchKeyword != null ? searchKeyword : ''}]],
      locationFilter: [[${locationFilter != null ? locationFilter : ''}]],
      priceFilter: [[${priceFilter != null ? priceFilter : ''}]],
      durationFilter: [[${durationFilter != null ? durationFilter : ''}]],
      sortType: [[${sortType != null ? sortType : 'recommend'}]],
      pageSize: [[${pageSize != null ? pageSize : 12}]]
    };
  </script>

  <script src="/js/list_test.js"></script>
</body>
</html>